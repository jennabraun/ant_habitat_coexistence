reps <- unique(ants$uniID)
unique(ants$highest.rtu)
#ants <- filter(ants, site == "PaPl" | site == "CaS" | site == "Lok" | site == "SemiT" | site == "SiCr")
ants.ag <- dplyr::select(ants, uniID, highest.rtu, quantity)
#collapse and sum ants within species within rep
ants.ag <- ants.ag %>% group_by(uniID, highest.rtu) %>% summarise(quantity = sum(quantity))
#check to make sure everything adds correctin
sum(ants.ag$quantity, na.rm = TRUE)
wide <- ants.ag %>% spread(highest.rtu, quantity)
#replace NA with zero
wide[is.na(wide)] <- 0
View(wide)
metadata <- veg
metadata$uniID <- paste(metadata$Site, metadata$month, metadata$field.micro)
metadata$uniID <- gsub(" ","", metadata$uniID)
row.names(metadata) <- metadata$uniID
zeroes <- anti_join(metadata, wide, by = "uniID")
View(zeroes)
View(wide)
View(wide)
View(metadata)
metadata <- veg
metadata$uniID <- paste(metadata$Site, metadata$month, metadata$field.micro)
metadata$uniID <- gsub(" ","", metadata$uniID)
View(metadata)
#I made clean metadata with identifiers and the correct microsite in the prey item project already
#just bring in that csv and drop the arth data
metadata <- read.csv("D:/Research/Projects/prey_item_survey/arth_clean.csv")
#I made clean metadata with identifiers and the correct microsite in the prey item project already
#just bring in that csv and drop the arth data
metadata <- read.csv("D:/Research/Projects/prey_item_survey/Clean Data/arth_clean.csv")
View(metadata)
row.names(metadata) <- metadata$uniID
zeroes <- anti_join(metadata, wide, by = "uniID")
zeroes <- select(zeroes, "uniID")
wide <- bind_rows(wide, zeroes)
wide[is.na(wide)] <- 0
metadata <- filter(metadata, uniID != "NA")
metadata <- metadata[match(wide$uniID, metadata$uniID),]
all.equal(metadata$uniID, wide$uniID)
metadata$abun <- apply(wide, 1, sum)
row.names(wide) <- wide$uniID
wide <- wide %>% ungroup(uniID) %>% select(-uniID)
metadata$abun <- apply(wide, 1, sum)
#check for total
sum(metadata$abun)
H <- diversity(wide)
simp <- diversity(wide, "simpson")
S <- specnumber(wide)
J <- H/log(S)
metadata$H <- H
metadata$Simpson <- simp
metadata$Species <- S
metadata$Even <- J
write.csv(metadata, "Clean Data/ants_clean.csv")
write.csv(wide, "Clean Data/wide_clean.csv")
write.csv(veg, "Clean Data/veg_clean.csv")
library(dplyr)
library(ggplot2)
library(MASS)
library(performance)
ants <- read.csv("Clean Data/ants_clean.csv")
wide <- read.csv("Clean Data/wide_clean.csv")
veg <- read.csv("Clean Data/veg_clean.csv")
m1 <- glm.nb(abun ~ Microsite + dry.veg.percent + Site, data = ants)
summary(m1)
car::Anova(m1)
summary(m1)
m2<- glm(S ~ Microsite + dry.veg.percent, data = ants)
View(ants)
m2<- glm(Species ~ Microsite + dry.veg.percent, data = ants)
summary(m2)
m2<- glm(Species ~ dry.veg.percent + Microsite + Site, family = "poisson", data = ants)
summary(m2)
check_overdispersion(m2)
aov(m2)
car::Anova(m2)
m2<- glm(Species ~ dry.veg.percent + Microsite + Site + month, family = "poisson", data = ants)
summary(m2)
m2<- glm(Species ~ dry.veg.percent + Microsite * Site + month, family = "poisson", data = ants)
summary(m2)
car::Anova(m2)
m2.m22 <- glmmTMB(S ~ dry.veg.percent + Microsite + (1|Site), family = "poisson", data = ants)
library(glmmTMB)
m2.m22 <- glmmTMB(S ~ dry.veg.percent + Microsite + (1|Site), family = "poisson", data = ants)
summary(m2.m22)
m2.m22 <- glmmTMB(Species ~ dry.veg.percent + Microsite + (1|Site), family = "poisson", data = ants)
summary(m2.m22)
a1 <- anosim(wide, ants$Microsite, permutations = 999, distance = "bray")
summary(a1)
c <- cca(wide, ants$Microsite)
c <- cca(wide ~ ants$Microsite)
summary(c)
anova.cca(c)
c <- cca(wide ~ ants$Microsite + ants$dry.veg.percent)
summary(c)
anova.cca(c)
anova(c)
anova(c, by = "margin")
anova(c, by = "terms")
library(dplyr)
library(ggplot2)
library(tidyr)
library(vegan)
library(XLConnect)
arth <- readWorksheetFromFile("Raw Data/Arthropod_data.xlsx", "Pitfalls")
#need to filter out NAs in these groups - I must have left them blank
#filter here so they don't count as zeroes
arth <- filter(arth, family == "Formicidae")
arth <- filter(arth, microsite != "NA" & microsite != "nolabel")
arth$microsite <- gsub(" ", "", arth$microsite)
unique(arth$microsite)
unique(arth$site)
unique(arth$month)
unique(arth$rep)
unique(arth$highest.rtu)
#I also want to filter out alates etc, but at this stage so I can sum easily
arth <- filter(arth, highest.rtu != "damaged")
arth <- filter(arth, highest.rtu != "alate")
a <- unique(arth$highest.rtu)
write.csv(a, "Clean Data/ant_species_list.csv")
#need to extract a list of trap ID that counts insects but no ants
#making a unique identifier to facilitate joining tables
arth$uniID <- paste(arth$site, arth$month, arth$microsite, arth$rep)
arth$uniID <- gsub(" ","", arth$uniID)
reps <- unique(arth$uniID)
write.csv(arth, "Clean Data/ants_long.csv")
arth.ag <- dplyr::select(arth, uniID, highest.rtu, quantity)
#collapse and sum arthropods within genus within rep
arth.ag <- arth.ag %>% group_by(uniID, highest.rtu) %>% summarise(abun = sum(quantity))
#check to make sure everything adds correctin
sum(arth.ag$abun, na.rm = TRUE)
metadata <- read.csv("Clean Data/pit_cov.csv")
metadata$uniID <- paste(metadata$Site, metadata$month, metadata$field.micro)
metadata$uniID <- gsub(" ","", metadata$uniID)
zeroes <- anti_join(metadata, wide, by = "uniID")
wide <- arth.ag %>% spread(highest.rtu, abun)
#replace NA with zero
wide[is.na(wide)] <- 0
zeroes <- anti_join(metadata, wide, by = "uniID")
View(zeroes)
pitnote <- read.csv("Clean Data/Pitfall_traps.csv")
View(pitnote)
pitnote$Site <- gsub("Carrizo Shrubless", "CaSl",pitnote$Site)
pitnote$Site <- gsub("Carrizo Shrub", "CaS",pitnote$Site)
pitnote$Site <- gsub("Lokern", "Lok",pitnote$Site)
pitnote$Site <- gsub("Semitropic", "SemiT",pitnote$Site)
pitnote$Site <- gsub("Avenal", "Aven",pitnote$Site)
pitnote$Site <- gsub("Coalinga", "Coal",pitnote$Site)
pitnote$Site <- gsub("Mountain View", "Mov",pitnote$Site)
pitnote$Site <- gsub("Panoche Plateau", "PaPl",pitnote$Site)
pitnote$Site <- gsub("Silver Creek", "SiCr",pitnote$Site)
pitnote <- separate(pitnote, "Date.trap.out", c("day", "month"), sep = "-")
pitnote$month <- gsub("Jul", "July", pitnote$month)
pitnote$month <- gsub("Sep", "Sept", pitnote$month)
pitnote$Microsite <- gsub("O", "o", pitnote$Microsite)
pitnote$Microsite <- gsub("S", "s", pitnote$Microsite)
pitnote$uniID <- paste(pitnote$Site, pitnote$month, pitnote$Microsite, pitnote$Rep)
pitnote$uniID <- gsub(" ", "", pitnote$uniID)
exc <- filter(pitnote, Exclude. == "Y")
z <- filter(pitnote, Exclude. == "N")
View(z)
exc <- exc$uniID
"%ni%" <- Negate("%in%")
metadata <- metadata %>% filter(uniID %ni% exc)
wide <- wide %>% filter(uniID %ni% exc)
wide <- read.csv("Clean Data/ants_wide.csv")
wide <- read.csv("Clean Data/ants_wide.csv")
cov <- read.csv("Clean Data/ants.csv")
View(wide)
View(cov)
View(cov)
m1 <- glm.nb(abun ~ Microsite + dry.veg.percent + Site, data = ants)
library(dplyr)
library(ggplot2)
library(MASS)
library(performance)
library(glmmTMB)
m1 <- glm.nb(abun ~ Microsite + dry.veg.percent + Site, data = ants)
m1 <- glm.nb(abun ~ Microsite + dry.veg.percent + Site, data = cov)
summary(m1)
car::Anova(m1)
m1.m11 <- glmmTMB(abun ~ dry.veg.percent + Microsite + (1|Site), family = "poisson", data = cov)
summary(m1.m11)
check_overdispersion(m1.m11)
m1.mnb <- glmmTMB(abun ~ dry.veg.percent + Microsite + (1|Site), family = "nbinom2", data = ants)
summary(m1.mnb)
m1.mnb <- glmmTMB(abun ~ dry.veg.percent + Microsite + (1|Site), family = "nbinom2", data = cov)
m1.mnb <- glmmTMB(abun ~ dry.veg.percent + Microsite + month + (1|Site), family = "nbinom2", data = cov)
summary(m1.mnb)
m1.mnb <- glmmTMB(abun ~ dry.veg.percent + Microsite + month + Prec + (1|Site), family = "nbinom2", data = cov)
View(cov)
m2.m22 <- glmmTMB(Species ~ dry.veg.percent + Microsite + month + (1|Site), family = "poisson", data = ants)
m2.m22 <- glmmTMB(Species ~ dry.veg.percent + Microsite + month + (1|Site), family = "poisson", data = cov)
summary(m2.m22)
sites <- read.csv("Clean Data/sites_joined.csv")
View(sites)
cov <- right_join(sites, cov, by = c("Site", "month"))
View(cov)
View(sites)
cov <- select(cov, 1:10, 14:19, 22:41)
cov <- dplyr::select(cov, 1:10, 14:19, 22:41)
View(cov)
library(dplyr)
library(ggplot2)
library(performance)
library(glmmTMB)
wide <- read.csv("Clean Data/ants_wide.csv")
cov <- read.csv("Clean Data/ants.csv")
sites <- read.csv("Clean Data/sites_joined.csv")
cov <- right_join(sites, cov, by = c("Site", "month"))
View(cov)
cov <- dplyr::select(cov, 3:10, 14:19, 22:36, 39:41)
View(cov)
m1.m11 <- glmmTMB(abun ~ dry.veg.percent + Microsite + month + mean.cover + Prec + (1|Site), family = "poisson", data = cov)
summary(m1.m11)
check_overdispersion(m1.m11)
m1.mnb <- glmmTMB(abun ~ dry.veg.percent + Microsite + month + mean.cover + Prec + (1|Site), family = "nbinom2", data = cov)
summary(m1.mnb)
m1.mnb <- glmmTMB(abun ~ dry.veg.percent + Microsite * month + mean.cover + Prec + (1|Site), family = "nbinom2", data = cov)
summary(m1.mnb)
m1.mnb <- glmmTMB(abun ~ dry.veg.percent + Microsite + month + mean.cover + Prec + (1|Site), family = "nbinom2", data = cov)
summary(m1.mnb)
m2 <- glmmTMB(Species ~ dry.veg.percent + Microsite + month + mean.cover + Prec + (1|Site), family = "nbinom2", data = cov)
summary(m2)
library(dplyr)
library(ggplot2)
library(tidyr)
library(vegan)
traits <- read.csv("raw data/Traits.csv")
View(traits)
slides <- read.csv("raw data/slides.csv")
View(slides)
View(slides)
View(traits)
traits <- separate(traits, Photo, c("Site", "Specimen"))
traits <- read.csv("raw data/Traits.csv")
traits <- separate(traits, Photo, c("Site", "Slide", "Specimen"))
traits <- traits[-1,]
traits.ag <- group_by(traits.ag, Site, X.1, Trait) %>% summarise(mean = mean(Measure), sd = sd(Measure))
traits.ag <- group_by(traits, Site, X.1, Trait) %>% summarise(mean = mean(Measure), sd = sd(Measure))
View(traits.ag)
traits.sp <- group_by(traits, X.1, Trait) %>% summarise(mean = mean(Measure), sd = sd(Measure))
View(traits.sp)
View(traits)
wide <- read.csv("Clean Data/ants_wide.csv")
cov <- read.csv("Clean Data/ants.csv")
sites <- read.csv("Clean Data/sites_joined.csv")
cov <- right_join(sites, cov, by = c("Site", "month"))
cov <- dplyr::select(cov, 3:10, 14:19, 22:36, 39:41)
View(cov)
View(wide)
View(cov)
wide$uniID <- cov$uniID
wide <- select(wide, -X)
View(wide)
wide <- select(wide, -10, -11)
long <- pivot_longer(wide, names_to = "species", values_to = "count")
long <- pivot_longer(wide, !uniID, names_to = "species", values_to = "count")
View(long)
long <- mutate(long, total = group_by(uniID) %>% summarise(sum))
long <- group_by(uniID) %>% mutate(total = sum(count))
long <- group_by(long, uniID) %>% mutate(total = sum(count))
View(long)
long <- long %>% mutate(rel.abun = count/total)
long <- separate(long, uniID, into = "Site", remove = FALSE)
View(long)
long <- pivot_longer(wide, !uniID, names_to = "species", values_to = "count")
long <- group_by(long, uniID) %>% mutate(total = sum(count))
long <- long %>% mutate(rel.abun = count/total)
long <- separate(long, uniID, into = c("Site", "Month"), remove = FALSE)
wide$Site <- cov$Site
wide <- select(wide, -X)
wide <- select(wide, -10, -11)
wide$uniID <- cov$uniID
View(wide)
long <- pivot_longer(wide, !uniID, !Site, names_to = "species", values_to = "count")
long <- pivot_longer(wide, 1:9, names_to = "species", values_to = "count")
View(long)
View(wide)
long <- group_by(long, uniID) %>% mutate(total = sum(count))
long <- long %>% mutate(rel.abun = count/total)
wide <- read.csv("Clean Data/ants_wide.csv")
wide$uniID <- cov$uniID
wide$Site <- cov$Site
wide <- select(wide, -X)
View(wide)
wide <- select(wide, -10, -11)
long <- pivot_longer(wide, 1:9, names_to = "species", values_to = "count")
View(wide)
long <- pivot_longer(wide, 1:11, names_to = "species", values_to = "count")
View(long)
long <- group_by(long, uniID) %>% mutate(total = sum(count))
long <- long %>% mutate(rel.abun = count/total)
traits.ag <- rename(traits.ag, species = X.1)
View(traits)
View(traits.ag)
View(long)
View(traits.sp)
View(traits.ag)
traits.ag$species <- gsub(" ", "", traits.ag$species)
join <- left_join(traits.ag, long, by = c("Site", "species"))
View(join)
join <- right_join(traits.ag, long, by = c("Site", "species"))
View(join)
join.right <- right_join(traits.ag, long, by = c("Site", "species"))
View(join.right)
CWM <- mutate(join.right, cwm = mean*rel.abun)
View(CWM)
ggplot(filter(CWM, Trait = femur), aes(cwm)) + geom_density()
ggplot(filter(CWM, Trait == femur), aes(cwm)) + geom_density()
ggplot(filter(CWM, Trait == Femur), aes(cwm)) + geom_density()
ggplot(filter(CWM, Trait == "Femur"), aes(cwm)) + geom_density()
ggplot(filter(CWM, Trait == "Femur"), aes(cwm, color = Site)) + geom_density()
ggplot(filter(CWM, Trait == "Femur" & cwm > 0), aes(cwm, color = Site)) + geom_density()
CWM <- mutate(join.right, cwm.prod = mean*rel.abun)
CWM <- group_by(uniID, Trait) %>% summarise(cwm = sum(cwm.prod))
CWM <- group_by(CWM, uniID, Trait) %>% summarise(cwm = sum(cwm.prod))
CWM <- group_by(CWM, Site, uniID, Trait) %>% summarise(cwm = sum(cwm.prod))
CWM <- mutate(join.right, cwm.prod = mean*rel.abun)
CWM <- group_by(CWM, Site, uniID, Trait) %>% summarise(cwm = sum(cwm.prod))
ggplot(filter(CWM, Trait == "Femur" & cwm > 0), aes(cwm, color = Site)) + geom_density()
CWM <- mutate(join.right, cwm.prod = mean*rel.abun)
CWM <- group_by(CWM, Site, uniID, Trait) %>% summarise(cwm = sum(cwm.prod))
ggplot(filter(CWM, Trait == "Femur" & cwm > 0), aes(cwm, color = Site)) + geom_density()
ggplot(filter(CWM, Trait == "Femur" & cwm > 0), aes(cwm, fill = Site)) + geom_density()
ggplot(filter(CWM, Trait == "Femur" & cwm > 0), aes(cwm, fill = Site)) + geom_boxplot()
ggplot(filter(CWM, Trait == "Femur"), aes(Site, cwm)) + geom_boxplot()
ggplot(filter(CWM, Trait == "Mandible"), aes(Site, cwm)) + geom_boxplot()
ggplot(filter(CWM, Trait == "Mandible length"), aes(Site, cwm)) + geom_boxplot()
ggplot(filter(CWM, Trait == "Mandible length"), aes(Site, cwm)) + geom_boxplot()
ggplot(filter(CWM, Trait == "Webers"), aes(Site, cwm)) + geom_boxplot()
ggplot(filter(CWM, Trait == "Scape"), aes(Site, cwm)) + geom_boxplot()
CWM <- mutate(join.right, cwm.prod = mean*rel.abun)
library(dplyr)
library(ggplot2)
library(tidyr)
wide <- read.csv("Clean Data/ants_wide.csv")
cov <- read.csv("Clean Data/ants.csv")
sites <- read.csv("Clean Data/sites_joined.csv")
cov <- right_join(sites, cov, by = c("Site", "month"))
cov <- dplyr::select(cov, 3:10, 14:19, 22:36, 39:41)
wide$uniID <- cov$uniID
wide$Site <- cov$Site
wide <- select(wide, -X)
wide <- select(wide, -10, -11)
long <- pivot_longer(wide, 1:11, names_to = "species", values_to = "count")
long <- group_by(long, uniID) %>% mutate(total = sum(count))
long <- long %>% mutate(rel.abun = count/total)
traits.ag <- rename(traits.ag, species = X.1)
traits.ag$species <- gsub(" ", "", traits.ag$species)
traits <- read.csv("raw data/Traits.csv")
traits <- separate(traits, Photo, c("Site", "Slide", "Specimen"))
traits <- traits[-1,]
traits.ag <- group_by(traits, Site, X.1, Trait) %>% summarise(mean = mean(Measure), sd = sd(Measure))
traits.sp <- group_by(traits, X.1, Trait) %>% summarise(mean = mean(Measure), sd = sd(Measure))
wide$uniID <- cov$uniID
wide$Site <- cov$Site
wide <- select(wide, -X)
wide <- select(wide, -10, -11)
wide <- read.csv("Clean Data/ants_wide.csv")
wide$uniID <- cov$uniID
wide$Site <- cov$Site
wide <- select(wide, -X)
wide <- select(wide, -10, -11)
long <- pivot_longer(wide, 1:11, names_to = "species", values_to = "count")
long <- group_by(long, uniID) %>% mutate(total = sum(count))
long <- long %>% mutate(rel.abun = count/total)
traits.ag <- rename(traits.ag, species = X.1)
traits.ag$species <- gsub(" ", "", traits.ag$species)
#this adds NA traits to 0 abundances - species isn't found at pitfall or site
join.right <- right_join(traits.ag, long, by = c("Site", "species"))
join.left <- left_join(traits.ag, long, by = c("Site", "species"))
CWM <- mutate(join.right, cwm.prod = mean*rel.abun)
CWM <- group_by(CWM, Site, uniID, Trait) %>% summarise(cwm = sum(cwm.prod))
ggplot(filter(CWM, Trait == "Scape"), aes(Site, cwm)) + geom_boxplot()
ggplot(filter(CWM, Trait == "Femur"), aes(Site, cwm)) + geom_boxplot()
View(wide)
unique(CWM$Site)
ggplot(filter(CWM, Trait == "Mandible length"), aes(Site, cwm)) + geom_boxplot()
si <- filter(CWM, Site == "SiCr")
View(si)
View(wide)
View(cov)
wide <- read.csv("Clean Data/ants_wide.csv")
View(wide)
library(dplyr)
library(tidyr)
library(ggplot2)
library(performance)
library(glmmTMB)
wide <- read.csv("Clean Data/ants_wide.csv")
cov <- read.csv("Clean Data/ants.csv")
sites <- read.csv("Clean Data/sites_joined.csv")
cov <- right_join(sites, cov, by = c("Site", "month"))
cov <- dplyr::select(cov, 3:10, 14:19, 22:36, 39:41)
traits <- read.csv("raw data/Traits.csv")
traits <- separate(traits, Photo, c("Site", "Slide", "Specimen"))
traits <- traits[-1,]
traits.ag <- group_by(traits, Site, X.1, Trait) %>% summarise(mean = mean(Measure), sd = sd(Measure))
traits.sp <- group_by(traits, X.1, Trait) %>% summarise(mean = mean(Measure), sd = sd(Measure))
View(wide)
site.j <- select(cov, uniID, Site)
wide <- right_join(site.j, wide, by = "uniID")
View(wide)
wide <- select(wide, -X)
wide <- select(wide, -12, -13)
long <- pivot_longer(wide, 3:13, names_to = "species", values_to = "count")
View(long)
long <- group_by(long, uniID) %>% mutate(total = sum(count))
long <- long %>% mutate(rel.abun = count/total)
traits.ag <- rename(traits.ag, species = X.1)
traits.ag$species <- gsub(" ", "", traits.ag$species)
#this adds NA traits to 0 abundances - species isn't found at pitfall or site
join.right <- right_join(traits.ag, long, by = c("Site", "species"))
CWM <- mutate(join.right, cwm.prod = mean*rel.abun)
CWM <- group_by(CWM, Site, uniID, Trait) %>% summarise(cwm = sum(cwm.prod))
ggplot(filter(CWM, Trait == "Mandible length"), aes(Site, cwm)) + geom_boxplot()
ggplot(filter(CWM, Trait == "Femur"), aes(Site, cwm)) + geom_boxplot()
ggplot(filter(CWM, Trait == "Webers"), aes(Site, cwm)) + geom_boxplot()
pl <- filter(CWM, Site == "PaPl")
View(pl)
View(join.right)
pl <- filter(join.right, Site == "PaPl")
View(pl)
View(pl)
pl <- filter(CWM, Site == "PaPl")
View(pl)
unique(long$Site)
unique(join.right$Site)
pl <- filter(long, Site == "PaPl")
View(cov)
plc <- filter(cov, Site == "PaPl")
View(plc)
plc <- filter(cov, Site == "PaPl" & abun == 0)
pl <- filter(long, Site == "PaPl")
View(traits.ag)
pl <- filter(CWM, Site == "PaPl")
CWM <- mutate(join.right, cwm.prod = mean*rel.abun)
View(CWM)
pl <- filter(CWM, Site == "PaPl")
unique(traits$Site)
traits$Site <- gsub("Papl", "PaPl", traits$Site)
unique(traits$Trait)
traits$Site <- gsub("Papl", "PaPl", traits$Site)
traits <- separate(traits, Photo, c("Site", "Slide", "Specimen"))
library(dplyr)
library(tidyr)
library(ggplot2)
library(performance)
library(glmmTMB)
wide <- read.csv("Clean Data/ants_wide.csv")
cov <- read.csv("Clean Data/ants.csv")
sites <- read.csv("Clean Data/sites_joined.csv")
cov <- right_join(sites, cov, by = c("Site", "month"))
cov <- dplyr::select(cov, 3:10, 14:19, 22:36, 39:41)
traits <- read.csv("raw data/Traits.csv")
unique(traits$Site)
unique(traits$Trait)
traits$Site <- gsub("Papl", "PaPl", traits$Site)
traits <- separate(traits, Photo, c("Site", "Slide", "Specimen"))
traits <- traits[-1,]
traits.ag <- group_by(traits, Site, X.1, Trait) %>% summarise(mean = mean(Measure), sd = sd(Measure))
unique(traits$Site)
traits$Site <- gsub("Papl", "PaPl", traits$Site)
traits <- separate(traits, Photo, c("Site", "Slide", "Specimen"))
View(traits)
traits <- read.csv("raw data/Traits.csv")
unique(traits$Site)
unique(traits$Site)
View(traits)
unique(traits$Trait)
traits <- separate(traits, Photo, c("Site", "Slide", "Specimen"))
traits$Site <- gsub("Papl", "PaPl", traits$Site)
unique(traits$Site)
traits <- traits[-1,]
traits.ag <- group_by(traits, Site, X.1, Trait) %>% summarise(mean = mean(Measure), sd = sd(Measure))
traits.sp <- group_by(traits, X.1, Trait) %>% summarise(mean = mean(Measure), sd = sd(Measure))
site.j <- select(cov, uniID, Site)
wide <- right_join(site.j, wide, by = "uniID")
wide <- select(wide, -X)
wide <- select(wide, -12, -13)
long <- pivot_longer(wide, 3:13, names_to = "species", values_to = "count")
long <- group_by(long, uniID) %>% mutate(total = sum(count))
long <- long %>% mutate(rel.abun = count/total)
traits.ag <- rename(traits.ag, species = X.1)
traits.ag$species <- gsub(" ", "", traits.ag$species)
#this adds NA traits to 0 abundances - species isn't found at pitfall or site
join.right <- right_join(traits.ag, long, by = c("Site", "species"))
CWM <- mutate(join.right, cwm.prod = mean*rel.abun)
CWM <- group_by(CWM, Site, uniID, Trait) %>% summarise(cwm = sum(cwm.prod))
ggplot(filter(CWM, Trait == "Webers"), aes(Site, cwm)) + geom_boxplot()
ggplot(filter(CWM, Trait == "Scape"), aes(Site, cwm)) + geom_boxplot()
m1 <- glm(cwm ~ Trait*Site, data = CWM)
summary(m1)
ggplot(filter(CWM, Trait == "Mandbile length"), aes(Site, cwm)) + geom_boxplot()
ggplot(filter(CWM, Trait == "Mandible length"), aes(Site, cwm)) + geom_boxplot()
ggplot(filter(CWM, Trait == "Mandible length"), aes(Site, cwm)) + geom_boxplot() + ylab("CWM Mandible length")
library(dplyr)
library(sf)
library(dplyr)
library(sf)
sites <- read.csv("Clean Data/sites_joined.csv")
sites <- st_read(sites)
site_sf <- st_as_sf(sites, coords = c("Long", "Lat"), crs = EPSG:4326)
site_sf <- st_as_sf(sites, coords = c("Long", "Lat"), crs = 4326)
plot(site_sf)
site_buf <- st_buffer(site_sf)
site_buf <- st_buffer(site_sf, dist = 50)
plot(site_buf)
View(site_buf)
st_write(site_sf, "Clean Data/sites.shp")
